script:
  - curl https://sh.rustup.rs -sSf | sh -s -- --default-toolchain nightly -y
  - export PATH="$HOME/.cargo/bin:$PATH"
  - rustc -Vv
  - cargo -Vv
  - git clone https://github.com/servo/servo
  - cd servo
  - GIT_PAGER= git log -n 1
  - echo '[tools]' > .servobuild
  - echo 'system-rust = true' >> .servobuild
  - echo 'system-cargo = true' >> .servobuild
  - echo 'cargo-home-dir = "~/.cargo"' >> .servobuild
  - ./mach cargo check

  # Tests seem to be failing (and taking too much time)
  # https://travis-ci.org/servo/servo-with-rust-nightly/builds/194321428
#  - ./mach build --dev
#  - ./mach test-compiletest
#  - ./mach test-unit

dist: trusty
sudo: 9000
addons:
  apt:
    packages:
      - cmake
      - freeglut3-dev
      - gperf
      - libosmesa6-dev
      - libgles2-mesa-dev
      - python-virtualenv
      - xorg-dev
      - ccache
      - libdbus-glib-1-dev
      - libavformat-dev
      - libavcodec-dev
      - libavutil-dev
      - libedit-dev
cache:
  directories:
    - $HOME/.cargo
    - $HOME/.ccache
env: CCACHE=/usr/bin/ccache
notifications:
  irc:
    channels: "irc.mozilla.org#servo"
    on_success: never
    on_failure: always
    template: "Servo failed to build with Rust nightly: %{build_url} CC nox, SimonSapin"
